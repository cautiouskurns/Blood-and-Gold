# Main Hub Scene Structure

**Status:** ðŸŸ¢ Implemented
**Priority:** ðŸ”¥ Critical
**Estimated Time:** 1.5 hours
**Dependencies:** Phase 2 complete
**Assigned To:** AI assistant (Claude Code)

---

## Purpose

**Why does this feature exist?**
The Hub serves as the central navigation point connecting all management screens in the game, providing players a home base to access contracts, manage their company, trade with merchants, and interact with companions between battles.

**What does it enable?**
Players can navigate between the core game loops - accepting contracts, recruiting soldiers at the barracks, purchasing equipment from merchants, and resting at camp to interact with companions. This creates the meta-game layer that ties tactical combat to company management.

**Success criteria:**
- Players can easily navigate to all sub-screens from the hub
- Gold display updates in real-time when resources change
- Scene transitions feel smooth and intuitive
- Hub reinforces the "Build & Command" design pillar by showing the player's mercenary company headquarters

---

## How It Works

### Overview

The Hub scene is the central management screen that players return to between contracts. It displays a fort interior background representing the player's mercenary company headquarters. The top bar shows the company name ("The Iron Company") and current gold reserves, giving players immediate visibility into their resources.

The main navigation is handled through a centered panel with prominent buttons for each destination: Contracts (to accept new missions), Barracks (to recruit soldiers), Merchant (to buy equipment), and Camp (to interact with companions). An additional "Enter Combat (Test)" button allows quick access to tactical combat for testing purposes.

Sub-screens are loaded into a container within the hub scene, maintaining the gold display and allowing easy navigation back to the main hub view. This creates a cohesive experience where players always feel connected to their headquarters.

### User Flow
```
1. Player enters Hub scene (from Main menu or after completing a contract)
2. Hub displays with company name, gold amount, and navigation buttons
3. Player clicks a navigation button (e.g., "CONTRACTS")
4. Sub-screen loads into the container, hiding main navigation
5. Player interacts with sub-screen content
6. Player clicks "< BACK" button or presses ESC
7. Sub-screen closes, main hub view returns
8. Result: Player can freely navigate between all management screens
```

### Rules & Constraints
- Only one sub-screen can be active at a time
- Gold display must update whenever GameState.gold changes
- ESC key should always return to main hub view from any sub-screen
- Hub scene cannot be exited except through the Combat button (for prototype)
- Company name is hardcoded to "The Iron Company" for prototype

### Edge Cases
- What happens if gold goes negative? GameState.spend_gold() returns false and prevents the transaction
- What happens if a sub-screen fails to load? Scene transition gracefully falls back to main hub
- What happens if player rapidly clicks navigation buttons? Only one sub-screen loads at a time

---

## User Interaction

### Controls
- **Left Click on Navigation Button**: Navigate to corresponding sub-screen
- **Left Click on "< BACK" Button**: Return to main hub from sub-screen
- **ESC Key**: Return to main hub from any sub-screen
- **Left Click on "Enter Combat (Test)"**: Transition to combat scene

### Visual Feedback
- Navigation buttons highlight on hover (Godot default button behavior)
- Active sub-screen replaces main navigation panel
- Gold amount updates immediately when changed
- Current screen context is always clear (title in sub-screen top bar)

### Audio Feedback (if applicable)
- Button click sounds (to be added in polish phase)
- Screen transition sounds (to be added in polish phase)

---

## Visual Design

### Layout
```
+----------------------------------------------------------+
|  [Company Name]                          GOLD: [Amount]   |  <- Top Bar
+----------------------------------------------------------+
|                                                           |
|                    COMPANY HEADQUARTERS                   |
|                    Select a destination                   |
|                                                           |
|              +----------------------------+               |
|              |        CONTRACTS           |               |
|              +----------------------------+               |
|              |        BARRACKS            |               |
|              +----------------------------+               |
|              |        MERCHANT            |               |
|              +----------------------------+               |
|              |          CAMP              |               |
|              +----------------------------+               |
|              |    ENTER COMBAT (Test)     |               |
|              +----------------------------+               |
|                                                           |
+----------------------------------------------------------+
```

### Components
- **TopBar (HBoxContainer)**: Contains company name and gold display, persists across sub-screens
- **CompanyName (Label)**: Displays "The Iron Company"
- **GoldDisplay (HBoxContainer)**: Shows "GOLD:" label and current amount
- **MainHubView (Control)**: Contains title and subtitle labels
- **NavigationPanel (PanelContainer)**: Contains all navigation buttons in a VBoxContainer
- **SubScreenContainer (Control)**: Container where sub-screens are instanced, hidden by default

### Visual Style
- Colors: Dark interior theme (#1e2028 background, matching fort interior)
- Fonts: Default Godot font (can be upgraded in polish phase)
- Animations: Instant scene transitions (can add fade in polish phase)
- Button sizing: 600px wide, 50px tall for comfortable clicking

### States
- **Default Hub View**: All navigation buttons visible, no sub-screen loaded
- **Sub-Screen Active**: MainHubView hidden, SubScreenContainer visible with loaded sub-screen
- **Button Hover**: Godot default hover state
- **Button Pressed**: Godot default pressed state
- **Insufficient Funds**: (N/A for hub navigation, applies to sub-screens)

---

## Technical Implementation

### Scene Structure
```
Hub (Control) [hub.gd]
â”œâ”€â”€ Background (ColorRect)
â”œâ”€â”€ TopBar (HBoxContainer)
â”‚   â”œâ”€â”€ CompanyName (Label)
â”‚   â””â”€â”€ GoldDisplay (HBoxContainer)
â”‚       â”œâ”€â”€ GoldIcon (Label) - "GOLD:"
â”‚       â””â”€â”€ GoldAmount (Label) - Dynamic amount
â”œâ”€â”€ MainHubView (Control)
â”‚   â””â”€â”€ CenterContent (VBoxContainer)
â”‚       â”œâ”€â”€ TitleLabel (Label) - "COMPANY HEADQUARTERS"
â”‚       â”œâ”€â”€ Spacer (Control)
â”‚       â””â”€â”€ SubtitleLabel (Label) - "Select a destination"
â”œâ”€â”€ NavigationPanel (PanelContainer)
â”‚   â””â”€â”€ VBoxContainer
â”‚       â”œâ”€â”€ ContractsButton (Button)
â”‚       â”œâ”€â”€ BarracksButton (Button)
â”‚       â”œâ”€â”€ MerchantButton (Button)
â”‚       â”œâ”€â”€ CampButton (Button)
â”‚       â””â”€â”€ CombatButton (Button)
â””â”€â”€ SubScreenContainer (Control) [hidden by default]
```

### Script Responsibilities
- **hub.gd:** Main hub controller - handles navigation button signals, loads/unloads sub-screens, manages visibility of MainHubView vs SubScreenContainer, updates gold display, handles ESC key input
- **game_state.gd (Autoload):** Global state management - tracks gold amount, current screen, emits signals for state changes
- **base_hub_screen.gd:** Base class for all sub-screens - provides common back button functionality, emits back_pressed signal

### Integration Points
- Connects to: GameState autoload for gold tracking and screen state
- Emits signals: None (uses GameState signals)
- Listens for:
  - GameState.gold_changed - to update gold display
  - GameState.screen_changed - to track current location
  - Sub-screen back_pressed - to return to main hub
- Modifies: GameState.current_screen when navigating

### Configuration
- JSON data: None (hardcoded for prototype)
- Tunable constants:
  - Starting gold: 500 (defined in GameState)
  - Company name: "The Iron Company" (defined in Hub.tscn)

---

## Acceptance Criteria

Feature is complete when:

- [x] Hub scene displays with fort background (ColorRect placeholder)
- [x] All 4 navigation buttons work (Contracts, Barracks, Merchant, Camp)
- [x] Gold amount visible in top right corner
- [x] Can navigate to each sub-screen by clicking buttons
- [x] Can return to hub from any sub-screen via back button
- [x] ESC key returns to main hub from sub-screens
- [x] Gold display updates when GameState.gold changes
- [x] Combat button transitions to Main.tscn (combat scene)

---

## Testing Checklist

### Functional Tests
- [x] Click Contracts button: ContractsScreen loads
- [x] Click Barracks button: BarracksScreen loads
- [x] Click Merchant button: MerchantScreen loads
- [x] Click Camp button: CampScreen loads
- [x] Click Enter Combat button: Transitions to Main.tscn
- [x] Gold display shows 500 on initial load

### Edge Case Tests
- [x] Press ESC with no sub-screen active: No effect (stays on hub)
- [x] Rapidly click multiple navigation buttons: Only one screen loads
- [x] Navigate to sub-screen and back multiple times: No memory leaks or errors

### Integration Tests
- [x] Works with GameState autoload
- [x] Sub-screens can access GameState for gold operations
- [x] Scene transition to combat works correctly

### Polish Tests
- [ ] Animations smooth (not yet implemented)
- [ ] Sounds play correctly (not yet implemented)
- [x] Visual feedback clear (buttons respond to input)
- [x] Performance acceptable (60 FPS)

---

## Implementation Notes

*(For AI assistant or future you)*

- **Sub-screen loading pattern:** Sub-screens are preloaded scenes instanced into SubScreenContainer. When a sub-screen's back_pressed signal is received, it's queue_free()'d and MainHubView is shown again.

- **GameState autoload:** Must be registered in project.godot under [autoload] section. The hub script expects GameState to be globally available.

- **ESC key handling:** Implemented in `_unhandled_input()` to ensure it works even when sub-screens have focus. ESC does nothing if already on main hub view.

- **Placeholder screens:** All sub-screens (ContractsScreen, BarracksScreen, MerchantScreen, CampScreen) are placeholders with "Coming in Task X.X" messages. They inherit from BaseHubScreen for consistent back button behavior.

- **Fort background:** Currently a simple ColorRect (#1e2028). A proper background sprite should be added in `assets/sprites/backgrounds/fort_interior.png` during polish phase.

- **Alternative considered:** Initially considered using SceneTree.change_scene_to_file() for sub-screens, but this would lose the persistent TopBar with gold display. The container-based approach maintains UI consistency.

---

## Files Created

| File | Purpose |
|------|---------|
| `scenes/hub/Hub.tscn` | Main hub scene |
| `scripts/hub/hub.gd` | Hub controller script |
| `scripts/autoload/game_state.gd` | Global state management |
| `scripts/hub/base_hub_screen.gd` | Base class for sub-screens |
| `scenes/hub/screens/ContractsScreen.tscn` | Contracts placeholder |
| `scenes/hub/screens/BarracksScreen.tscn` | Barracks placeholder |
| `scenes/hub/screens/MerchantScreen.tscn` | Merchant placeholder |
| `scenes/hub/screens/CampScreen.tscn` | Camp placeholder |
| `scripts/hub/screens/contracts_screen.gd` | Contracts script |
| `scripts/hub/screens/barracks_screen.gd` | Barracks script |
| `scripts/hub/screens/merchant_screen.gd` | Merchant script |
| `scripts/hub/screens/camp_screen.gd` | Camp script |

---

## Design Alignment

### Design Pillars Supported

**Build & Command:** The hub represents the player's growing mercenary company headquarters. As they complete contracts and upgrade their fort, this becomes their home base - a visual representation of their progress.

**Meaningful Choice:** The hub is the decision point where players choose which contracts to take, which soldiers to recruit, and which equipment to buy. Limited gold forces prioritization.

### Player Fantasy Reinforcement
The hub reinforces the "founding a mercenary company" fantasy by putting the player in command of a fort with various management options. The company name and gold display create a sense of ownership and progression.
