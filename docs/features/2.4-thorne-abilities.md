# Feature Spec: Thorne Abilities

| Property | Value |
|----------|-------|
| **Feature ID** | 2.4 |
| **Status** | üî¥ Planned |
| **Priority** | ‚¨ÜÔ∏è High |
| **Estimated Time** | 2 hours |
| **Phase** | Phase 2: Abilities & Party Interaction |
| **Dependencies** | Task 2.3 (Player Abilities - ability system exists) |

---

## 1. Purpose

### Why This Feature Exists

Thorne Blackwood is the party's heavy melee fighter and damage sponge. His abilities define a distinct playstyle focused on holding the line, protecting allies by forcing enemies to attack him, and surviving through overwhelming odds. Without Thorne's abilities, he would be just another melee unit rather than the "immovable wall" fantasy the GDD describes. This feature directly supports the **Tactical Combat** pillar by providing unique crowd control and tanking options.

### What It Enables

- **Cleave**: Area damage against multiple adjacent enemies - punishes enemy clustering
- **Taunt**: Forces enemy AI to attack Thorne - protects squishier party members
- **Last Stand**: Dramatic survival mechanic - clutch plays when things go wrong
- Foundation for tank/protector tactical role in party composition
- Visible demonstration that each party member plays differently
- Tests the ability system with multi-target and passive trigger abilities

### Success Criteria

| Criterion | Measurement |
|-----------|-------------|
| Cleave hits multiple | Deals damage to 2 adjacent enemies in a 90-degree arc |
| Taunt forces aggro | All enemies within 3 tiles target Thorne for 1 turn |
| Last Stand triggers | Thorne survives lethal damage at 1 HP once |
| Abilities visible | All 4 abilities appear in Thorne's ability bar |
| Strategic impact | Playtesters use Thorne to protect other party members |

---

## 2. Design Pillar Alignment

| Pillar | How This Feature Supports It |
|--------|------------------------------|
| **Tactical Combat** | Thorne's abilities create tactical decisions: Where to position for Cleave? When to Taunt to save an ally? Last Stand creates dramatic comeback moments. Each ability rewards smart positioning and timing. |
| **Build & Command** | Thorne fills the "tank" role in the mercenary company. His abilities make him essential for holding chokepoints and protecting Lyra/Matthias. This reinforces the party composition strategy. |
| **Meaningful Choice** | Using Taunt means enemies attack Thorne instead of Lyra - a real tradeoff. Cleave vs single-target damage is a positioning puzzle. Last Stand is a safety net that rewards aggressive play. |
| **Character Progression** | Thorne's abilities reflect his personality: honorable combat (Cleave - face enemies directly), protective nature (Taunt - take hits for others), stubborn determination (Last Stand - refuse to die). |

---

## 3. How It Works

### Overview

Thorne has 4 abilities that define his role as a frontline tank and multi-target melee specialist:

1. **Basic Attack** - Standard melee attack using his sword (1d8 + STR)
2. **Cleave** - Arc attack hitting up to 2 adjacent enemies simultaneously
3. **Taunt** - Forces all enemies within 3 tiles to attack Thorne for 1 turn
4. **Last Stand** - Passive trigger: survive lethal damage at 1 HP (once per battle)

Cleave and Taunt are active abilities that require targeting/activation. Last Stand is a passive that triggers automatically when Thorne would take lethal damage. Each ability (except Basic Attack and Last Stand) can only be used once per battle.

### User Flow

```
CLEAVE FLOW:
1. Player selects Thorne (his turn)
2. Click Cleave ability in ability bar
3. Game enters "arc targeting" mode
4. Player selects a tile direction (determines arc center)
5. Game highlights which enemies will be hit (up to 2 in 90-degree arc)
6. Player confirms (click again) or cancels (right-click/ESC)
7. Thorne performs attack animation toward arc center
8. Damage dealt to all enemies in arc
9. Damage numbers float up from each hit enemy
10. Cleave marked as used (grayed out in ability bar)
11. Turn ends

TAUNT FLOW:
1. Player selects Thorne (his turn)
2. Click Taunt ability in ability bar
3. No targeting needed - activates immediately
4. Visual effect shows Taunt radius (3 tiles)
5. All enemies within range get "Taunted" status effect
6. Taunted enemies show indicator (icon above head)
7. For 1 turn, those enemies MUST target Thorne
8. Taunt marked as used (grayed out)
9. Turn continues (Taunt doesn't end turn - can still move/attack)

LAST STAND FLOW (Passive):
1. Thorne takes damage that would reduce HP to 0 or below
2. System checks: Has Last Stand triggered this battle? No.
3. Instead of dying, HP set to 1
4. Visual effect: Golden glow, dramatic sound
5. "Last Stand!" text floats above Thorne
6. Last Stand marked as triggered (show indicator)
7. If Thorne takes ANY damage next turn, he dies normally
8. If healed, Last Stand "consumed" - won't trigger again this battle
```

### Rules & Constraints

| Rule | Description |
|------|-------------|
| Cleave requires adjacency | Thorne must be adjacent to at least 1 enemy |
| Cleave hits max 2 | Even if 3+ enemies in arc, only hits 2 |
| Cleave arc is 90 degrees | Fan shape originating from Thorne |
| Cleave uses same attack roll | Single roll applies to all targets |
| Taunt range is 3 tiles | Measured from Thorne (not counting Thorne's tile) |
| Taunt duration is 1 turn | Enemies forced to target Thorne for their next turn |
| Taunt doesn't end turn | Thorne can still move/attack after Taunt |
| Taunted enemies must target Thorne | Even if Thorne is not adjacent (they move toward him) |
| Last Stand triggers once | Only activates first time Thorne would die |
| Last Stand sets HP to 1 | Not 0 - Thorne is alive but critical |
| Last Stand expires | After 1 turn, Thorne can die normally |
| Abilities (except Basic) once per battle | Cleave, Taunt, Last Stand usable once each |

### Edge Cases

| Scenario | Behavior |
|----------|----------|
| Cleave with only 1 adjacent enemy | Still works, hits the 1 enemy |
| Cleave with 0 adjacent enemies | Ability unavailable (grayed out) |
| Cleave with 3+ enemies in arc | Hits closest 2 (or player chooses 2) |
| Taunt with 0 enemies in range | Still activates (no effect, wastes ability) |
| Taunted enemy cannot reach Thorne | Moves toward Thorne as close as possible, then waits |
| Taunted enemy kills Thorne | Taunt effect ends, remaining taunted enemies free |
| Last Stand during enemy turn | Triggers immediately, damage stops at 1 HP |
| Last Stand then healed same turn | Thorne survives, Last Stand consumed |
| Last Stand then take 0 damage | Thorne survives until hit again |
| Multiple Taunts (future: allies with Taunt) | Most recent Taunt wins |
| Thorne dies, then resurrected (future) | Last Stand does NOT reset |

---

## 4. User Interaction

### Controls

| Input | Action | Context |
|-------|--------|---------|
| Click Cleave button | Enter arc targeting mode | Thorne selected, adjacent enemies exist |
| Click direction tile | Select arc center | Arc targeting mode |
| Click again / Enter | Confirm Cleave | Valid targets highlighted |
| Right-click / ESC | Cancel Cleave | Arc targeting mode |
| Click Taunt button | Activate Taunt immediately | Thorne selected |
| (No input for Last Stand) | Triggers automatically | Thorne would die |

### Visual Feedback

| Event | Visual |
|-------|--------|
| Cleave targeting | 90-degree arc overlay from Thorne |
| Cleave targets | Enemies in arc highlighted red |
| Cleave execution | Sword swing animation across arc |
| Cleave damage | Multiple damage numbers, one per target |
| Taunt activation | Circular pulse effect around Thorne (3 tile radius) |
| Taunted status | Red exclamation icon above affected enemies |
| Taunt duration | Icon pulses/fades as duration expires |
| Last Stand trigger | Golden glow on Thorne, screen flash |
| Last Stand active | Persistent golden outline on Thorne |
| Last Stand text | "LAST STAND!" floating text |

### Audio Feedback (Future)

| Event | Sound |
|-------|-------|
| Cleave swing | Heavy sword whoosh |
| Cleave hit | Impact sound per enemy |
| Taunt activation | War cry / shout |
| Taunt applied | Aggression sound per enemy |
| Last Stand trigger | Dramatic orchestral sting |
| Last Stand active | Low heartbeat ambient |

*Note: Audio is out of scope for prototype but noted for future.*

---

## 5. Visual Design

### Cleave Arc Targeting

```
          Enemy
            E
           /
    [90¬∞ ARC]
         / \
        /   \
       T-----
     Thorne

Arc Selection: Player clicks a direction, arc fans out 45¬∞ each side
```

### Taunt Range Indicator

```
        . . . . .
      . . . . . . .
    . . . . . . . . .
    . . . [T] . . . .    <- T = Thorne, . = affected tiles
    . . . . . . . . .
      . . . . . . .
        . . . . .

Range: 3 tiles in all directions (diamond shape for grid)
```

### Status Effect Icons

| Icon | Meaning | Position |
|------|---------|----------|
| Red exclamation (!) | Taunted by Thorne | Above enemy HP bar |
| Golden sword | Last Stand active | Above Thorne HP bar |
| Crossed swords | Cleave used | Ability bar (grayed) |
| Speech bubble | Taunt used | Ability bar (grayed) |

### Color Scheme

| Element | Color |
|---------|-------|
| Cleave arc overlay | Red (#e74c3c) at 40% opacity |
| Cleave target highlight | Bright red (#ff6b6b) |
| Taunt range indicator | Yellow (#f1c40f) at 30% opacity |
| Taunted status icon | Red (#c0392b) |
| Last Stand glow | Gold (#f1c40f) |
| Last Stand text | Gold (#f1c40f) with white outline |

---

## 6. Technical Implementation

### Ability Resource Structure

**resources/abilities/cleave.tres:**
```gdscript
[gd_resource type="Resource" script_class="Ability"]

[resource]
id = "cleave"
name = "Cleave"
description = "Swing in a wide arc, hitting up to 2 adjacent enemies."
icon = "res://assets/sprites/ui/ability_icons/cleave.png"
targeting_type = "arc"
range = 1
arc_angle = 90
max_targets = 2
damage_type = "physical"
damage_modifier = 1.0  # Normal damage
uses_per_battle = 1
ends_turn = true
```

**resources/abilities/taunt.tres:**
```gdscript
[gd_resource type="Resource" script_class="Ability"]

[resource]
id = "taunt"
name = "Taunt"
description = "Force all enemies within 3 tiles to attack you next turn."
icon = "res://assets/sprites/ui/ability_icons/taunt.png"
targeting_type = "self"
range = 3
effect_type = "status"
status_effect = "taunted"
status_duration = 1
uses_per_battle = 1
ends_turn = false  # Can still act after Taunt
```

**resources/abilities/last_stand.tres:**
```gdscript
[gd_resource type="Resource" script_class="Ability"]

[resource]
id = "last_stand"
name = "Last Stand"
description = "When you would take lethal damage, survive with 1 HP instead. Once per battle."
icon = "res://assets/sprites/ui/ability_icons/last_stand.png"
targeting_type = "passive"
trigger = "on_lethal_damage"
effect_type = "survive"
survive_hp = 1
uses_per_battle = 1
```

### Script Responsibilities

**scripts/resources/ability.gd (EXISTS from Task 2.3):**
- Define Ability resource class with all properties
- Support different targeting types (single, arc, self, passive)
- Track uses per battle

**scripts/combat/ability_executor.gd (NEW or MODIFY):**
- `execute_cleave(caster, direction)` - Handle arc damage
- `execute_taunt(caster)` - Apply taunted status to enemies
- `check_last_stand(unit)` - Check passive trigger on damage

**scripts/combat/status_effects.gd (NEW or MODIFY):**
- `TauntedEffect` class - Forces enemy to target Thorne
- `LastStandEffect` class - Tracks one-time survival trigger

**scripts/combat/unit.gd (MODIFY):**
- Add `_status_effects: Array[StatusEffect]`
- Modify `take_damage()` to check Last Stand
- Add `get_taunt_target()` for AI to check forced targets

**scripts/combat/enemy_ai.gd (MODIFY):**
- Check for Taunted status before selecting target
- If taunted, must target the taunt source (Thorne)

### Detailed Implementation: Cleave

```gdscript
## In ability_executor.gd

func execute_cleave(caster: Unit, direction: Vector2i) -> void:
    ## Execute Cleave attack hitting up to 2 enemies in 90-degree arc

    # Get adjacent tiles in the arc direction
    var arc_tiles = _get_arc_tiles(caster.grid_position, direction, 90)

    # Find enemies in those tiles
    var targets: Array[Unit] = []
    for tile in arc_tiles:
        var unit = _get_unit_at_tile(tile)
        if unit and unit.is_enemy:
            targets.append(unit)
            if targets.size() >= 2:
                break  # Max 2 targets

    if targets.is_empty():
        print("[AbilityExecutor] Cleave: No targets in arc")
        return

    # Single attack roll for all targets
    var attack_result = AttackResolver.roll_attack(caster)

    # Apply damage to each target
    for target in targets:
        if attack_result.roll + attack_result.modifier >= target.get_defense():
            var damage = AttackResolver.calculate_damage(caster, target)
            target.take_damage(damage)
            _spawn_damage_number(target, damage, false)
            print("[Cleave] Hit %s for %d damage" % [target.unit_name, damage])
        else:
            _spawn_damage_number(target, 0, false)  # Miss
            print("[Cleave] Missed %s" % target.unit_name)

    # Mark ability as used
    caster.mark_ability_used("cleave")

    # Emit signal for visual effects
    ability_executed.emit(caster, "cleave", targets)

func _get_arc_tiles(origin: Vector2i, direction: Vector2i, arc_degrees: int) -> Array[Vector2i]:
    ## Get all tiles within an arc from origin
    var tiles: Array[Vector2i] = []
    var half_arc = arc_degrees / 2

    # Get adjacent tiles (8 directions for square grid)
    var adjacent = [
        Vector2i(0, -1),   # N
        Vector2i(1, -1),   # NE
        Vector2i(1, 0),    # E
        Vector2i(1, 1),    # SE
        Vector2i(0, 1),    # S
        Vector2i(-1, 1),   # SW
        Vector2i(-1, 0),   # W
        Vector2i(-1, -1),  # NW
    ]

    # Calculate angle of the direction
    var dir_angle = atan2(direction.y, direction.x)

    for adj in adjacent:
        var adj_angle = atan2(adj.y, adj.x)
        var angle_diff = abs(rad_to_deg(adj_angle - dir_angle))

        # Normalize angle difference
        if angle_diff > 180:
            angle_diff = 360 - angle_diff

        # Check if within arc
        if angle_diff <= half_arc:
            tiles.append(origin + adj)

    return tiles
```

### Detailed Implementation: Taunt

```gdscript
## In ability_executor.gd

func execute_taunt(caster: Unit) -> void:
    ## Apply Taunted status to all enemies within range
    var taunt_range = 3
    var affected_enemies: Array[Unit] = []

    # Get all enemies within range
    for enemy in _get_all_enemies():
        var distance = _calculate_distance(caster.grid_position, enemy.grid_position)
        if distance <= taunt_range:
            # Apply taunted status
            var taunt_effect = TauntedEffect.new()
            taunt_effect.source = caster
            taunt_effect.duration = 1  # 1 turn
            enemy.add_status_effect(taunt_effect)
            affected_enemies.append(enemy)
            print("[Taunt] %s is now taunted by %s" % [enemy.unit_name, caster.unit_name])

    # Mark ability as used
    caster.mark_ability_used("taunt")

    # Emit signal for visual effects
    ability_executed.emit(caster, "taunt", affected_enemies)

    print("[Taunt] %d enemies taunted" % affected_enemies.size())
```

### Detailed Implementation: Last Stand

```gdscript
## In unit.gd - Modify take_damage()

func take_damage(amount: int) -> void:
    ## Apply damage to unit, checking for Last Stand
    var new_hp = current_hp - amount

    # Check for lethal damage
    if new_hp <= 0:
        # Check for Last Stand
        if _check_last_stand():
            new_hp = 1
            _on_last_stand_triggered()
            print("[Unit] %s Last Stand triggered! HP set to 1" % unit_name)

    current_hp = max(0, new_hp)
    _update_hp_bar()
    unit_damaged.emit(self, amount)

    if current_hp <= 0:
        _die()

func _check_last_stand() -> bool:
    ## Check if Last Stand should trigger
    # Must have Last Stand ability
    if not has_ability("last_stand"):
        return false

    # Must not have used it already
    if is_ability_used("last_stand"):
        return false

    return true

func _on_last_stand_triggered() -> void:
    ## Handle Last Stand activation
    mark_ability_used("last_stand")

    # Add visual effect
    var last_stand_effect = LastStandActiveEffect.new()
    last_stand_effect.duration = 1  # Expires after 1 turn (for visual indicator)
    add_status_effect(last_stand_effect)

    # Emit signal for VFX
    last_stand_triggered.emit(self)
```

### Integration Points

| System | Integration |
|--------|-------------|
| AbilityBar | Shows Cleave, Taunt, Last Stand, Basic Attack |
| AbilityExecutor | Executes Cleave and Taunt logic |
| StatusEffects | TauntedEffect forces enemy targeting |
| Unit.take_damage | Checks Last Stand passive |
| EnemyAI | Respects Taunted status |
| CombatGrid | Provides arc tile calculation |
| DamageNumber | Shows damage for each Cleave target |

### Signals

| Signal | Emitter | Parameters | Purpose |
|--------|---------|------------|---------|
| `ability_executed` | AbilityExecutor | `(caster, ability_id, targets)` | Trigger VFX/SFX |
| `status_applied` | Unit | `(unit, effect)` | Show status icon |
| `last_stand_triggered` | Unit | `(unit)` | Trigger dramatic VFX |
| `taunt_expired` | StatusEffect | `(unit)` | Remove taunt indicator |

---

## 7. File Structure

```
scripts/
‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îî‚îÄ‚îÄ ability.gd                    # EXISTS from 2.3
‚îú‚îÄ‚îÄ combat/
‚îÇ   ‚îú‚îÄ‚îÄ ability_executor.gd           # MODIFY: Add Cleave, Taunt execution
‚îÇ   ‚îú‚îÄ‚îÄ status_effects.gd             # NEW or MODIFY: TauntedEffect, LastStandEffect
‚îÇ   ‚îú‚îÄ‚îÄ unit.gd                       # MODIFY: Status effects, Last Stand check
‚îÇ   ‚îî‚îÄ‚îÄ enemy_ai.gd                   # MODIFY: Respect Taunt
‚îî‚îÄ‚îÄ UI/
    ‚îî‚îÄ‚îÄ status_icon.gd                # NEW: Display status icons

resources/
‚îî‚îÄ‚îÄ abilities/
    ‚îú‚îÄ‚îÄ cleave.tres                   # NEW: Cleave ability resource
    ‚îú‚îÄ‚îÄ taunt.tres                    # NEW: Taunt ability resource
    ‚îî‚îÄ‚îÄ last_stand.tres               # NEW: Last Stand ability resource

assets/sprites/ui/ability_icons/
‚îú‚îÄ‚îÄ cleave.png                        # NEW: Cleave icon (placeholder)
‚îú‚îÄ‚îÄ taunt.png                         # NEW: Taunt icon (placeholder)
‚îî‚îÄ‚îÄ last_stand.png                    # NEW: Last Stand icon (placeholder)

assets/sprites/ui/status_icons/
‚îú‚îÄ‚îÄ taunted.png                       # NEW: Taunted status icon
‚îî‚îÄ‚îÄ last_stand_active.png             # NEW: Last Stand active icon
```

---

## 8. Acceptance Criteria

| # | Criterion | Test Method |
|---|-----------|-------------|
| 1 | Cleave hits 2 enemies if positioned correctly | Position Thorne adjacent to 2 enemies, use Cleave |
| 2 | Cleave shows arc targeting indicator | Click Cleave, observe arc overlay |
| 3 | Cleave damage numbers appear for each target | Execute Cleave, count damage popups |
| 4 | Taunt forces enemies to target Thorne | Use Taunt, observe enemy turn |
| 5 | Taunt shows range indicator | Click Taunt, observe radius |
| 6 | Taunted enemies show status icon | Use Taunt, check enemy icons |
| 7 | Last Stand triggers on lethal damage | Reduce Thorne to 0 HP, verify survives |
| 8 | Last Stand sets HP to exactly 1 | Check HP bar after trigger |
| 9 | Last Stand only triggers once | Heal Thorne, reduce to 0 again |
| 10 | Abilities appear in Thorne's ability bar | Select Thorne, check bar |
| 11 | Used abilities grayed out | Use Cleave, verify grayed |

---

## 9. Testing Checklist

### Functional Tests - Cleave
- [ ] Cleave available when adjacent to enemy
- [ ] Cleave unavailable with no adjacent enemies
- [ ] Arc targeting shows correct tiles
- [ ] Cleave hits exactly 2 enemies maximum
- [ ] Cleave damage uses normal attack calculation
- [ ] Cleave can miss (if attack roll fails)
- [ ] Cleave marked as used after execution
- [ ] Cleave ends Thorne's turn

### Functional Tests - Taunt
- [ ] Taunt activates immediately (no targeting)
- [ ] Taunt range is exactly 3 tiles
- [ ] All enemies in range get Taunted status
- [ ] Taunted enemies have visible icon
- [ ] Taunted enemies must attack Thorne
- [ ] Taunted enemies move toward Thorne if not adjacent
- [ ] Taunt does NOT end turn
- [ ] Taunt effect expires after 1 turn
- [ ] Taunt marked as used after activation

### Functional Tests - Last Stand
- [ ] Last Stand triggers when HP would go to 0
- [ ] HP set to exactly 1 after trigger
- [ ] Visual indicator shows Last Stand active
- [ ] "LAST STAND!" text appears
- [ ] Thorne can still act after trigger
- [ ] Last Stand does NOT trigger second time
- [ ] Thorne dies normally after Last Stand consumed

### Integration Tests
- [ ] Abilities appear in AbilityBar for Thorne only
- [ ] Enemy AI respects Taunt forcing
- [ ] Status effects display correctly
- [ ] Last Stand works during enemy turn
- [ ] Cleave works with attack of opportunity (future)
- [ ] Taunt combines with movement (future)

### Edge Cases
- [ ] Cleave with exactly 1 enemy - hits 1
- [ ] Cleave with 3 enemies - hits 2
- [ ] Taunt with 0 enemies in range - activates anyway
- [ ] Last Stand then immediate heal - survives
- [ ] Multiple enemies taunted - all must target
- [ ] Thorne dies while enemies taunted - effect ends

---

## 10. Implementation Notes

### Approach Rationale

**Why arc targeting for Cleave?**
- More tactical than "hit all adjacent" - requires positioning
- Creates interesting flanking setups
- Distinguishes Cleave from future "whirlwind" style abilities
- 90 degrees is wide enough to be useful, narrow enough to require thought

**Why doesn't Taunt end the turn?**
- Allows Thorne to Taunt then move into position
- Creates combo potential (Taunt ‚Üí Attack)
- More impactful than a turn-ending "I do nothing but yell"
- Matches tank fantasy - draw aggro AND contribute damage

**Why is Last Stand passive?**
- Active "don't die" buttons feel bad to press (when do you use it?)
- Passive creates dramatic surprise moments
- Players don't have to remember to use it
- Still strategic - players build around knowing Thorne has a safety net

**Why once per battle for all abilities?**
- Prevents spamming (Cleave every turn = boring)
- Creates meaningful choices about timing
- Matches prototype scope (no cooldown system yet)
- Can expand to cooldowns in full production

### Gotchas to Watch

1. **Arc calculation edge cases**: Diagonal vs cardinal directions in arc targeting
2. **Taunt AI override**: Enemy AI must check Taunt BEFORE normal target selection
3. **Last Stand timing**: Must trigger BEFORE death processing
4. **Status effect persistence**: Taunted must persist across turn boundaries
5. **Multi-target damage**: Each Cleave target needs separate damage roll
6. **Ability bar refresh**: Gray out abilities IMMEDIATELY after use

### Alternative Approaches Considered

| Approach | Pros | Cons | Decision |
|----------|------|------|----------|
| Cleave hits ALL adjacent | Simpler | Less tactical | Rejected |
| **Cleave arc targeting** | Tactical depth | More complex | **Chosen** |
| Taunt ends turn | Simpler | Less powerful | Rejected |
| **Taunt free action** | More tactical | AI complexity | **Chosen** |
| Last Stand active ability | Player choice | Feels bad | Rejected |
| **Last Stand passive** | Dramatic | Less control | **Chosen** |

### Dependencies on Previous Tasks

- **Task 2.2 (Ability UI)**: AbilityBar must show Thorne's abilities
- **Task 2.3 (Player Abilities)**: Ability system and AbilityExecutor must exist
- **Task 2.1 (Party Members)**: Thorne unit must exist with correct stats
- **Task 1.7 (Attack System)**: Damage resolution for Cleave

### Future Enhancements (Out of Scope)

- Cleave upgrade: Hit 3 enemies at higher levels
- Taunt upgrade: Longer duration or larger range
- Last Stand upgrade: Heal small amount on trigger
- Visual effects: Shield slam animation for Taunt
- Audio: Thorne voice lines ("COME AT ME!")
- Synergies: Cleave bonus damage to Taunted enemies

---

## 11. Definition of Done

- [ ] `resources/abilities/cleave.tres` created
- [ ] `resources/abilities/taunt.tres` created
- [ ] `resources/abilities/last_stand.tres` created
- [ ] Cleave arc targeting implemented and working
- [ ] Cleave hits up to 2 adjacent enemies
- [ ] Taunt applies status to enemies in range
- [ ] Taunted enemies forced to target Thorne
- [ ] Taunted status icon visible on affected enemies
- [ ] Last Stand triggers on lethal damage
- [ ] Last Stand sets HP to 1 and shows indicator
- [ ] All 4 abilities appear in Thorne's ability bar
- [ ] Abilities grayed out after use
- [ ] Enemy AI respects Taunt
- [ ] All acceptance criteria pass
- [ ] Console logging shows ability execution
- [ ] Code follows GDScript style guidelines

---

## 12. References

### From GDD

- **Thorne Blackwood** (Section 4: Party Members):
  - Stats: STR 16, DEX 10, CON 14, INT 10, WIS 12, CHA 8
  - HP: 40
  - Abilities: Cleave (hit 2 adjacent enemies), Taunt (enemies must attack him), Last Stand (can't die for 1 turn at 0 HP)
  - Purpose: Heavy melee, damage sponge
  - Loyalty triggers: Honor in combat (+), Assassination (-)

- **Combat System** (Section 3):
  - Attack Roll: d20 + modifier vs Defense
  - Grid-based positioning matters
  - Status effects can modify behavior

### From Roadmap

- **Task 2.4**: Implement Thorne Abilities (Phase 2, 2 hours)
- **What**: Thorne's 4 abilities: Cleave, Taunt, Last Stand, Basic Attack
- **Hardcoded Values**:
  - Cleave arc: 90 degrees, hits enemies in adjacent tiles
  - Taunt range: 3 tiles
  - Taunt duration: 1 turn
  - Last Stand HP: 1
- **Dependencies**: Task 2.3 (ability system exists)
- **Related Tasks**: 2.5 (Lyra), 2.6 (Matthias)

### Godot Documentation

- [Resource](https://docs.godotengine.org/en/stable/classes/class_resource.html)
- [Signals](https://docs.godotengine.org/en/stable/getting_started/step_by_step/signals.html)
- [Vector math](https://docs.godotengine.org/en/stable/tutorials/math/vector_math.html)
- [atan2 for angles](https://docs.godotengine.org/en/stable/classes/class_@globalscope.html#class-globalscope-method-atan2)
