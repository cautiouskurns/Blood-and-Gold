# Feature Spec: Unit Placeholder Sprites

| Property | Value |
|----------|-------|
| **Feature ID** | 1.2 |
| **Status** | Planning |
| **Priority** | Critical |
| **Estimated Time** | 1.5 hours |
| **Phase** | Phase 1: Combat Visuals & Basic Interaction |
| **Dependencies** | Task 1.1 (Combat Grid Display) |

---

## 1. Purpose

### Why This Feature Exists

Units are the core interactive elements in Blood & Gold's tactical combat. Without visible units on the grid, players cannot see their party, enemies, or make tactical decisions. The Unit scene establishes the foundation for all character representation - from the player character to companions, soldiers, and enemies. This directly supports the **Build & Command** design pillar by making the mercenary company visible on the battlefield.

### What It Enables

- Players can see their party members positioned on the combat grid
- Visual distinction between friendly units (blue tones) and enemies (red tones)
- Foundation for HP bars, selection indicators, and movement (Tasks 1.3-1.5)
- Each party member has a unique identifier (letter + color) for quick recognition
- Units snap to grid tiles, reinforcing the tactical grid-based gameplay

### Success Criteria

| Criterion | Measurement |
|-----------|-------------|
| Units render on grid | Colored squares visible at grid positions |
| Party distinction | Blue-toned units clearly different from red enemies |
| Individual identification | Each companion has unique color/letter |
| Proper sizing | 56x56 sprites fit within 64x64 tiles with padding |
| Grid alignment | Units centered on tile positions |

---

## 2. Design Pillar Alignment

| Pillar | How This Feature Supports It |
|--------|------------------------------|
| **Build & Command** | Visible party members and soldiers create the "commanding a mercenary company" fantasy - you can SEE your forces on the battlefield |
| **Tactical Combat** | Distinct unit colors enable quick friend/foe identification during tactical decision-making |
| **Character Progression** | Individual companion colors establish visual identity that persists through the game |

---

## 3. How It Works

### Overview

Each unit is represented by a 56x56 pixel colored square with a letter identifier. The Unit scene (`Unit.tscn`) serves as the base scene that all specific unit types (party members, soldiers, enemies) inherit from or instantiate.

Units are placed on the combat grid using grid coordinates, and the Unit script converts these to world positions using the CombatGrid's `grid_to_world()` function. Units are always centered on their tile.

### Unit Visual Design

**Party Units (Blue Tones):**
| Character | Color | Hex Code | Letter |
|-----------|-------|----------|--------|
| Player | Blue | #3498db | P |
| Thorne | Dark Blue | #2980b9 | T |
| Lyra | Purple | #9b59b6 | L |
| Matthias | Orange | #f39c12 | M |

**Enemy Units (Red Tones):**
| Unit Type | Color | Hex Code | Letter |
|-----------|-------|----------|--------|
| All Enemies | Red | #e74c3c | E |

### Unit Specifications

| Property | Value | Rationale |
|----------|-------|-----------|
| Sprite size | 56 x 56 pixels | Fits within 64x64 tile with 4px padding on each side |
| Letter size | ~24px font | Large enough to read at a glance |
| Letter color | White (#ffffff) | Contrasts with all background colors |
| Border | 2px, slightly darker | Defines unit boundary clearly |

### Grid Positioning

Units snap to grid tile centers. When a unit is placed at grid position (3, 5):
1. CombatGrid's `grid_to_world(Vector2i(3, 5))` returns world position
2. Unit positions itself at that world position
3. Unit sprite (56x56) appears centered in the tile (64x64)

```
┌────────────────────────────────────────┐
│        64x64 tile                      │
│   ┌────────────────────────────────┐   │
│   │                                │   │
│   │   ┌────────────────────────┐   │   │
│   │   │    56x56 unit sprite   │   │   │
│   │   │         ┌───┐          │   │   │
│   │   │         │ P │          │   │   │
│   │   │         └───┘          │   │   │
│   │   └────────────────────────┘   │   │
│   │                                │   │
│   └────────────────────────────────┘   │
│  4px padding on each side              │
└────────────────────────────────────────┘
```

---

## 4. User Interaction

### This Task

**No user interaction in Task 1.2** - this is purely visual rendering. Units appear on the grid but cannot be selected or moved yet.

Interaction comes in later tasks:
- Task 1.4: Click-to-select units
- Task 1.5: Click-to-move with path preview

### Visual Feedback (This Task)

| Element | Feedback |
|---------|----------|
| Unit loads | Colored square with letter appears on grid tile |
| Party vs Enemy | Immediately distinguishable by color (blue vs red) |
| Individual companions | Each has unique color for identification |

### Future Interaction (Not This Task)

- Click unit: Selection indicator appears (Task 1.4)
- HP display: Health bar above unit (Task 1.3)
- Movement: Unit tweens between tiles (Task 1.5)

---

## 5. Visual Design

### Unit Appearance

**Player Unit (P):**
```
┌──────────────────────────────┐
│                              │
│   Blue Background (#3498db)  │
│                              │
│          ┌─────┐             │
│          │  P  │  White text │
│          └─────┘             │
│                              │
│   56x56 pixels               │
│   2px darker border          │
└──────────────────────────────┘
```

**Companion Units:**
- Same layout as Player
- Unique background color per companion
- Respective letter (T, L, M)

**Enemy Unit (E):**
```
┌──────────────────────────────┐
│                              │
│   Red Background (#e74c3c)   │
│                              │
│          ┌─────┐             │
│          │  E  │  White text │
│          └─────┘             │
│                              │
│   56x56 pixels               │
│   2px darker border          │
└──────────────────────────────┘
```

### Color Palette

| Element | Color | Hex | Usage |
|---------|-------|-----|-------|
| Player background | Blue | #3498db | Player character unit |
| Player border | Dark Blue | #2980b9 | 2px border |
| Thorne background | Dark Blue | #2980b9 | Thorne unit |
| Thorne border | Darker Blue | #1f618d | 2px border |
| Lyra background | Purple | #9b59b6 | Lyra unit |
| Lyra border | Dark Purple | #7d3c98 | 2px border |
| Matthias background | Orange | #f39c12 | Matthias unit |
| Matthias border | Dark Orange | #d68910 | 2px border |
| Enemy background | Red | #e74c3c | All enemy units |
| Enemy border | Dark Red | #c0392b | 2px border |
| Letter text | White | #ffffff | All unit letters |

### Sprite Creation Options

**Option A: Pre-made PNG sprites (Recommended)**
- Create 56x56 PNG images in image editor
- Each sprite has solid color fill + border + white letter
- Import as Sprite2D texture

**Option B: Programmatic generation**
- Use Godot's drawing functions or create textures at runtime
- More flexible but more complex

---

## 6. Technical Implementation

### Scene Structure

```
Unit.tscn
├── Unit (Node2D) [root]
│   ├── Sprite2D (Sprite2D)
│   │   └── Texture: placeholder sprite
│   └── Label (Label) [optional: if not baked into sprite]
│       └── Text: "P", "T", "L", "M", or "E"
```

### Node Details

| Node | Type | Purpose |
|------|------|---------|
| Unit | Node2D | Root node, handles positioning and unit logic |
| Sprite2D | Sprite2D | Displays the unit's colored square |
| Label | Label | (Optional) Displays letter if not baked into sprite |

### Script Responsibilities

**unit.gd**
```gdscript
extends Node2D
class_name Unit

# Unit identification
@export var unit_name: String = "Unit"
@export var unit_letter: String = "U"
@export var is_enemy: bool = false

# Grid position (logical)
var grid_position: Vector2i = Vector2i.ZERO

# Stats (for future tasks)
@export var max_hp: int = 30
var current_hp: int = 30

# Reference to grid (set by CombatManager or parent)
var combat_grid: CombatGrid

@onready var sprite: Sprite2D = $Sprite2D

func _ready() -> void:
    current_hp = max_hp
    _update_visual()

func _update_visual() -> void:
    # Update sprite based on unit type
    # If using pre-made sprites, load appropriate texture
    pass

# Place unit on grid at specified coordinates
func place_on_grid(coords: Vector2i) -> void:
    grid_position = coords
    if combat_grid:
        position = combat_grid.grid_to_world(coords)

# Get current grid position
func get_grid_position() -> Vector2i:
    return grid_position

# Set grid reference
func set_combat_grid(grid: CombatGrid) -> void:
    combat_grid = grid

# Snap to grid position (utility)
func snap_to_grid() -> void:
    if combat_grid:
        position = combat_grid.grid_to_world(grid_position)
```

### Unit Variant Scenes (Optional)

For cleaner organization, create variant scenes:

```
scenes/combat/units/
├── Unit.tscn              # Base unit scene
├── PlayerUnit.tscn        # Inherits Unit, Player-specific
├── ThorneUnit.tscn        # Inherits Unit, Thorne-specific
├── LyraUnit.tscn          # Inherits Unit, Lyra-specific
├── MatthiasUnit.tscn      # Inherits Unit, Matthias-specific
└── EnemyUnit.tscn         # Inherits Unit, Enemy-specific
```

Or use a single Unit.tscn with exported properties to configure appearance.

### Integration Points

| System | Integration |
|--------|-------------|
| CombatGrid (Task 1.1) | Uses `grid_to_world()` for positioning |
| HP Bars (Task 1.3) | HP bar added as child of Unit |
| Selection (Task 1.4) | Area2D added for click detection |
| Movement (Task 1.5) | Unit tweens to new grid position |
| Turn system (Task 1.8) | Units added to turn order |

### Signals (For Future Use)

```gdscript
signal unit_clicked(unit: Unit)
signal unit_moved(unit: Unit, from: Vector2i, to: Vector2i)
signal unit_damaged(unit: Unit, amount: int)
signal unit_died(unit: Unit)
```

---

## 7. File Structure

```
scenes/
└── combat/
    ├── Unit.tscn                    # Base unit scene
    └── units/                       # (Optional) Unit variants
        ├── PlayerUnit.tscn
        ├── ThorneUnit.tscn
        ├── LyraUnit.tscn
        ├── MatthiasUnit.tscn
        └── EnemyUnit.tscn

scripts/
└── combat/
    └── unit.gd                      # Unit logic

assets/
└── sprites/
    └── units/
        ├── placeholder_player.png   # 56x56 blue with "P"
        ├── placeholder_thorne.png   # 56x56 dark blue with "T"
        ├── placeholder_lyra.png     # 56x56 purple with "L"
        ├── placeholder_matthias.png # 56x56 orange with "M"
        └── placeholder_enemy.png    # 56x56 red with "E"
```

---

## 8. Acceptance Criteria

| # | Criterion | Test Method |
|---|-----------|-------------|
| 1 | Can instantiate unit on any grid tile | Create unit, call `place_on_grid(Vector2i(5, 5))`, verify position |
| 2 | Unit sprite centered on tile | Measure 4px gap on all sides within 64x64 tile |
| 3 | Party units are blue-toned | Visual verification of Player, Thorne, Lyra, Matthias colors |
| 4 | Enemy units are red-toned | Visual verification of enemy color |
| 5 | Unit size is 56x56 pixels | Sprite dimensions check |
| 6 | Letters visible and readable | P, T, L, M, E clearly legible |
| 7 | Each companion has unique color | All 4 party members distinguishable |
| 8 | Unit script has grid position tracking | `get_grid_position()` returns correct Vector2i |
| 9 | Multiple units can exist on grid | Place 4+ units, all render correctly |
| 10 | Units don't overlap grid boundaries | Units fully within their tile |

---

## 9. Testing Checklist

### Functional Tests
- [ ] Unit scene instantiates without errors
- [ ] `place_on_grid()` positions unit correctly
- [ ] `get_grid_position()` returns correct coordinates
- [ ] Multiple units can be placed on different tiles
- [ ] Unit sprite displays correctly

### Visual Tests
- [ ] Player unit is blue (#3498db) with "P"
- [ ] Thorne unit is dark blue (#2980b9) with "T"
- [ ] Lyra unit is purple (#9b59b6) with "L"
- [ ] Matthias unit is orange (#f39c12) with "M"
- [ ] Enemy unit is red (#e74c3c) with "E"
- [ ] Letters are white and readable
- [ ] Units are centered within tiles
- [ ] 2px borders visible on all units

### Integration Tests
- [ ] Units work with CombatGrid's `grid_to_world()` function
- [ ] Units placed on walkable tiles render correctly
- [ ] Multiple units on grid don't overlap
- [ ] Scene runs without errors in Main.tscn

### Edge Cases
- [ ] Unit placed at grid boundary (0,0) renders correctly
- [ ] Unit placed at grid boundary (11,11) renders correctly
- [ ] Unit grid_position updates when `place_on_grid()` called

---

## 10. Implementation Notes

### Approach Rationale

**Why colored squares with letters?**
- Maximum clarity for prototype - no ambiguity about which unit is which
- Quick to create - no art skills required
- Easy to distinguish at any zoom level
- Letters (P, T, L, M, E) prevent confusion when colors are similar

**Why 56x56 sprites in 64x64 tiles?**
- 4px padding creates visual breathing room
- Units don't touch tile edges, looks cleaner
- Room for HP bars above without overlapping adjacent tiles
- Standard "slightly smaller than tile" approach from tactical games

**Why individual colors per companion?**
- Reinforces character identity
- Matches their thematic roles (Thorne=cold/stoic, Lyra=mysterious, Matthias=warm/holy)
- Easy identification even without reading letters
- Lays groundwork for visual storytelling

### Gotchas to Watch

1. **Sprite centering**: Ensure Sprite2D's `centered` property is true, or offset manually
2. **Grid reference**: Unit needs reference to CombatGrid - pass via setter or autoload
3. **Z-index**: Units should render above grid tiles (higher z_index or tree order)
4. **Coordinate types**: Grid uses Vector2i, world uses Vector2 - don't mix them up

### Future Considerations

- **Animations**: Units will need idle/move/attack animations in full production
- **Facing direction**: May need to flip sprites based on last move direction
- **Status effects**: Visual indicators for buffs/debuffs above HP bar
- **Death state**: Sprite change or fade when unit dies

---

## 11. Definition of Done

- [ ] `Unit.tscn` scene created with Sprite2D
- [ ] `unit.gd` script implements grid positioning
- [ ] 5 placeholder sprite images created (P, T, L, M, E)
- [ ] All party member colors match specification
- [ ] Enemy color matches specification
- [ ] Units can be placed on any grid tile
- [ ] Units snap to tile center correctly
- [ ] All acceptance criteria pass
- [ ] Code follows GDScript style guidelines
- [ ] Ready for Task 1.3 (HP Bars Above Units)

---

## 12. References

### From GDD

- **Party Members**: "4 party members (Player, Thorne, Lyra, Matthias)" (Section 4: Party Members)
- **Player Character**: "STR 14, DEX 12, CON 14... HP: 35" (Section 4)
- **Placeholder Art**: "Placeholder sprites, simple shapes acceptable" (Section 5: What's OUT)
- **Unit Scale**: "8-12 units vs 15-20 enemies" (Section 2: Critical Questions)

### From Roadmap

- **Task 1.2**: Unit Placeholder Sprites (Phase 1, Day 1, 1.5 hours)
- **Dependencies**: Task 1.1 (Combat Grid Display)
- **Leads to**: Task 1.3 (HP Bars Above Units)
- **Hardcoded Values**: Unit size 56x56, colors as specified

### Godot Documentation

- [Sprite2D](https://docs.godotengine.org/en/stable/classes/class_sprite2d.html)
- [Node2D positioning](https://docs.godotengine.org/en/stable/tutorials/2d/2d_transforms.html)
- [Custom drawing](https://docs.godotengine.org/en/stable/tutorials/2d/custom_drawing_in_2d.html)
