# Contract Board UI

**Status:** üî¥ Planned
**Priority:** ‚¨ÜÔ∏è High
**Estimated Time:** 2 hours
**Dependencies:** Task 3.1 (Main Hub Scene Structure) - Complete
**Assigned To:** AI assistant (Claude Code)

---

## Purpose

**Why does this feature exist?**
The Contract Board UI provides players with a visual interface to browse available missions, compare rewards and difficulty, and make meaningful choices about which contracts to accept for their mercenary company.

**What does it enable?**
Players can view 2-3 available contracts at once, each displaying key information (name, brief description, reward, difficulty). They can click contracts to see expanded details and accept missions that match their company's capabilities and goals.

**Success criteria:**
- Players can quickly assess contract options at a glance
- Contract difficulty and rewards are clearly communicated visually
- The selection process feels strategic and deliberate
- Accepting a contract smoothly transitions the player into the mission flow
- Supports the "Meaningful Choice" design pillar by making contract selection feel consequential

---

## How It Works

### Overview

The Contract Board replaces the placeholder content in the existing ContractsScreen, displaying a board-style interface with 2-3 contract cards. Each card shows essential information in a scannable format: the contract name, a brief one-line description, gold reward, and a visual difficulty indicator (using stars or icons).

When a player clicks on a contract card, it expands or transitions to a detailed view showing the full contract briefing, objectives, and any special conditions. The detailed view includes an "Accept Contract" button that commits the player to the mission and transitions to the appropriate scene (pre-combat dialogue or combat setup).

The contract data is stored in Resource files (.tres) using a custom Contract class, allowing designers to easily create and modify contracts. For the prototype, 3 hardcoded contracts will be defined: Merchant's Escort (tutorial), Clear the Ruins (combat-focused), and The Border Dispute (choice-focused).

### User Flow
```
1. Player navigates to Contracts from hub
2. Contract Board displays showing 2-3 available contract cards
3. Player scans cards, comparing rewards and difficulty
4. Player clicks a contract card to view details
5. Detailed view shows full briefing, objectives, reward breakdown
6. Player clicks "Accept Contract" button
7. System marks contract as accepted, hides it from available pool
8. Scene transitions to contract start (pre-combat or combat)
9. Result: Player committed to chosen contract
```

### Rules & Constraints
- Maximum 3 contracts displayed at once (prototype scope)
- Only one contract can be active at a time
- Accepted contracts are removed from the board until completed
- Completed contracts do not return to the board
- Contract difficulty affects enemy composition and count
- Rewards are fixed per contract (no random variation in prototype)

### Edge Cases
- What happens if all contracts are completed? Display "No contracts available" message with note that this is end of prototype content
- What happens if player tries to accept contract with active mission? Prevent with disabled button and tooltip explaining active contract must be completed
- What happens if player clicks back while viewing contract details? Returns to contract board without accepting
- What happens if contract data fails to load? Display error message and hide that contract card

---

## User Interaction

### Controls
- **Left Click on Contract Card**: Expand to show contract details
- **Left Click on "Accept Contract" Button**: Accept the contract and begin mission
- **Left Click on "Close" or outside detail panel**: Return to contract board view
- **Left Click on "< BACK" Button**: Return to main hub
- **ESC Key**: Return to main hub (if on board) or close details (if viewing details)

### Visual Feedback
- Contract cards highlight on hover with subtle border glow
- Selected/active contract card has distinct highlighted state
- Difficulty indicators use color coding (Green=Easy, Yellow=Medium, Red=Hard)
- Gold reward prominently displayed with gold coin icon
- Accept button pulses subtly when details are open to draw attention
- Accepted contract shows brief "Contract Accepted!" confirmation before transition

### Audio Feedback (if applicable)
- Button click sounds (using Godot UI defaults for prototype)
- Paper/parchment sound when opening contract details (polish phase)
- Coin sound when accepting contract with reward preview (polish phase)

---

## Visual Design

### Layout
```
+----------------------------------------------------------+
|  < BACK                    CONTRACTS                      |  <- Top Bar
+----------------------------------------------------------+
|                                                           |
|   CONTRACT BOARD                                          |
|   Choose a contract for your company                      |
|                                                           |
|   +----------------------+  +----------------------+      |
|   | MERCHANT'S ESCORT    |  | CLEAR THE RUINS      |      |
|   | Escort a merchant    |  | Clear bandits from   |      |
|   | wagon through bandit |  | the old ruins        |      |
|   | territory            |  |                      |      |
|   |                      |  |                      |      |
|   | [GOLD] 300g   [*--]  |  | [GOLD] 500g   [**-]  |      |
|   +----------------------+  +----------------------+      |
|                                                           |
|   +----------------------+                                |
|   | THE BORDER DISPUTE   |                                |
|   | A delicate situation |                                |
|   | at the Ironmark      |                                |
|   | border...            |                                |
|   |                      |                                |
|   | [GOLD] 300-600g [**-]|                                |
|   +----------------------+                                |
|                                                           |
+----------------------------------------------------------+
```

### Contract Detail View (Modal/Overlay)
```
+----------------------------------------------------------+
|                    CONTRACT DETAILS                    [X] |
+----------------------------------------------------------+
|                                                           |
|  MERCHANT'S ESCORT                          Difficulty: * |
|  -------------------------------------------------------- |
|                                                           |
|  BRIEFING:                                                |
|  A merchant needs safe passage through the forest road.   |
|  Bandit activity has increased along the route. Protect   |
|  the wagon and its cargo at all costs.                    |
|                                                           |
|  OBJECTIVES:                                              |
|  - PRIMARY: Escort wagon to destination                   |
|  - SECONDARY: No soldier casualties                       |
|                                                           |
|  REWARD: 300 gold                                         |
|                                                           |
|  ENEMIES: Bandits (estimated 6)                           |
|  MAP: Forest Clearing                                     |
|                                                           |
|              +---------------------------+                |
|              |      ACCEPT CONTRACT      |                |
|              +---------------------------+                |
|                                                           |
+----------------------------------------------------------+
```

### Components
- **ContractBoard (VBoxContainer)**: Main container for board layout
- **BoardTitle (Label)**: "CONTRACT BOARD" header with subtitle
- **ContractCardsContainer (HBoxContainer/GridContainer)**: Holds contract cards in grid
- **ContractCard (PanelContainer)**: Individual contract preview card
- **ContractDetailPanel (PanelContainer)**: Expanded detail overlay/modal
- **AcceptButton (Button)**: Prominent button to accept contract

### Visual Style
- Colors:
  - Card background: #2a2a3a (dark parchment-like)
  - Card border default: #4a4a5a (subtle)
  - Card border hover: #7a7a8a (highlighted)
  - Card border selected: #f1c40f (gold highlight)
  - Easy difficulty: #27ae60 (green)
  - Medium difficulty: #f39c12 (yellow/orange)
  - Hard difficulty: #e74c3c (red)
  - Gold text: #f1c40f (gold)
- Fonts: Default Godot font (upgrade in polish phase)
- Animations:
  - Card hover: Scale to 1.02 over 0.1s
  - Detail panel: Fade in over 0.2s
  - Accept confirmation: Brief flash before transition

### States
- **Default Card**: Normal appearance, clickable
- **Hover Card**: Slight scale increase, border highlight
- **Selected Card**: Gold border, slightly elevated appearance
- **Completed Card**: (Not shown - removed from board)
- **Detail View Open**: Card selected, detail panel visible, background dimmed
- **Accept Button Disabled**: Grayed out with tooltip (if already have active contract)

---

## Technical Implementation

### Scene Structure
```
ContractsScreen (Control) [contracts_screen.gd] - EXISTING, modify
‚îú‚îÄ‚îÄ TopBar (HBoxContainer) - EXISTING
‚îÇ   ‚îú‚îÄ‚îÄ BackButton (Button)
‚îÇ   ‚îú‚îÄ‚îÄ TitleLabel (Label)
‚îÇ   ‚îî‚îÄ‚îÄ Spacer (Control)
‚îú‚îÄ‚îÄ ContentPanel (Panel) - EXISTING, repurpose
‚îÇ   ‚îî‚îÄ‚îÄ ContractBoard (VBoxContainer) - NEW
‚îÇ       ‚îú‚îÄ‚îÄ BoardHeader (VBoxContainer)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ BoardTitle (Label) - "CONTRACT BOARD"
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ BoardSubtitle (Label) - "Choose a contract..."
‚îÇ       ‚îî‚îÄ‚îÄ CardsContainer (HBoxContainer)
‚îÇ           ‚îú‚îÄ‚îÄ ContractCard1 (ContractCard.tscn instance)
‚îÇ           ‚îú‚îÄ‚îÄ ContractCard2 (ContractCard.tscn instance)
‚îÇ           ‚îî‚îÄ‚îÄ ContractCard3 (ContractCard.tscn instance)
‚îî‚îÄ‚îÄ ContractDetailPanel (PanelContainer) [hidden by default] - NEW
    ‚îú‚îÄ‚îÄ DetailHeader (HBoxContainer)
    ‚îÇ   ‚îú‚îÄ‚îÄ DetailTitle (Label)
    ‚îÇ   ‚îî‚îÄ‚îÄ CloseButton (Button)
    ‚îú‚îÄ‚îÄ DetailContent (VBoxContainer)
    ‚îÇ   ‚îú‚îÄ‚îÄ ContractName (Label)
    ‚îÇ   ‚îú‚îÄ‚îÄ DifficultyDisplay (HBoxContainer)
    ‚îÇ   ‚îú‚îÄ‚îÄ BriefingSection (VBoxContainer)
    ‚îÇ   ‚îú‚îÄ‚îÄ ObjectivesSection (VBoxContainer)
    ‚îÇ   ‚îú‚îÄ‚îÄ RewardSection (HBoxContainer)
    ‚îÇ   ‚îî‚îÄ‚îÄ EnemyInfoSection (VBoxContainer)
    ‚îî‚îÄ‚îÄ AcceptButton (Button)
```

### New Scene: ContractCard.tscn
```
ContractCard (PanelContainer) [contract_card.gd]
‚îú‚îÄ‚îÄ MarginContainer
‚îÇ   ‚îî‚îÄ‚îÄ VBoxContainer
‚îÇ       ‚îú‚îÄ‚îÄ ContractName (Label)
‚îÇ       ‚îú‚îÄ‚îÄ BriefDescription (Label) [autowrap, max 3 lines]
‚îÇ       ‚îî‚îÄ‚îÄ FooterRow (HBoxContainer)
‚îÇ           ‚îú‚îÄ‚îÄ RewardDisplay (HBoxContainer)
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ GoldIcon (TextureRect or Label)
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ GoldAmount (Label)
‚îÇ           ‚îî‚îÄ‚îÄ DifficultyStars (HBoxContainer)
‚îÇ               ‚îî‚îÄ‚îÄ [Star labels/icons]
```

### Script Responsibilities
- **contracts_screen.gd:** Main contract board controller - loads available contracts from GameState, creates card instances, handles card selection, shows/hides detail panel, processes contract acceptance, emits contract_accepted signal
- **contract_card.gd:** Individual card behavior - displays contract data, handles hover/click states, emits card_clicked signal with contract reference
- **contract.gd (Resource):** Contract data class - defines contract properties (id, name, brief, full_briefing, objectives, reward, difficulty, map_scene, enemy_setup)
- **game_state.gd (Autoload):** Track available/completed contracts, active_contract reference

### Integration Points
- Connects to: GameState for contract availability and active contract tracking
- Emits signals:
  - `contract_selected(contract: Contract)` - when card clicked
  - `contract_accepted(contract: Contract)` - when accept button pressed
- Listens for:
  - `contract_card.card_clicked` - from individual cards
  - `GameState.contract_completed` - to update available contracts
- Modifies:
  - GameState.active_contract when accepting
  - GameState.available_contracts when contract accepted/completed

### Configuration
- JSON data: None (contracts defined as .tres Resource files for prototype)
- Contract resources location: `resources/contracts/`
- Tunable constants (in contracts_screen.gd):
  - `MAX_DISPLAYED_CONTRACTS: int = 3`
  - `CARD_WIDTH: int = 300`
  - `CARD_HEIGHT: int = 150`
  - `CARD_SPACING: int = 20`

---

## Acceptance Criteria

Feature is complete when:

- [ ] Contract board shows 2-3 available contracts as cards
- [ ] Each card displays: contract name, brief description, gold reward, difficulty indicator
- [ ] Clicking a contract card shows expanded detail view
- [ ] Detail view shows full briefing, objectives, reward, enemy info
- [ ] Accept button in detail view accepts the contract
- [ ] Accepting contract updates GameState.active_contract
- [ ] Accepted contract is removed from available contracts list
- [ ] Back button returns to hub from contract board
- [ ] ESC key closes detail view or returns to hub appropriately
- [ ] Contract Resource class (contract.gd) created with all required fields

---

## Testing Checklist

### Functional Tests
- [ ] Contract board displays on entering Contracts screen
- [ ] All 3 prototype contracts appear as cards
- [ ] Click contract card: Detail panel appears
- [ ] Click Accept: Contract accepted, scene transition occurs
- [ ] Click Close (X): Detail panel closes, returns to board
- [ ] Difficulty stars/indicators show correct values
- [ ] Gold amounts display correctly

### Edge Case Tests
- [ ] Accept contract with no active contract: Succeeds
- [ ] Try to accept when already have active contract: Button disabled with tooltip
- [ ] All contracts completed: "No contracts available" message shown
- [ ] Rapid clicking on cards: Only one detail panel opens
- [ ] Click back while detail panel open: Closes detail, then back works

### Integration Tests
- [ ] Works with existing ContractsScreen structure
- [ ] GameState.active_contract updates correctly
- [ ] GameState.available_contracts reflects accepted contracts
- [ ] Scene transition to contract scene works
- [ ] Back navigation to hub works correctly

### Polish Tests
- [ ] Card hover animation smooth
- [ ] Detail panel fade-in smooth
- [ ] Visual feedback clear on all interactions
- [ ] Performance acceptable (60 FPS)
- [ ] Layout responsive to different screen sizes (basic)

---

## Implementation Notes

*(For AI assistant or future you)*

- **Existing structure:** ContractsScreen.tscn already exists with TopBar, BackButton, and ContentPanel. Modify ContentPanel children rather than restructuring the whole scene.

- **BaseHubScreen inheritance:** contracts_screen.gd extends BaseHubScreen which provides back button handling. Don't override this unless necessary.

- **Contract Resource pattern:** Create a Contract class extending Resource with @export properties. This allows creating .tres files in the editor for each contract.

- **Prototype contracts:** Create 3 .tres files:
  - `resources/contracts/merchants_escort.tres` - Tutorial, 300g, Easy
  - `resources/contracts/clear_the_ruins.tres` - Combat, 500g, Medium
  - `resources/contracts/border_dispute.tres` - Choice, 300-600g, Medium

- **Difficulty display:** Use a simple star system (1-3 stars) or colored icons. Stars are more universally understood. Consider using Label with unicode stars (‚òÖ‚òÜ) for simplicity.

- **Card size constraint:** 300x150px is specified, but ensure text fits with autowrap and ellipsis for long descriptions.

- **Scene transition:** When accepting contract, the transition target depends on the contract type. Tutorial and combat contracts go directly to combat setup. Choice contracts (like Border Dispute) go to a pre-combat dialogue scene first.

- **Future-proofing:** The contract system should be easily expandable for more contracts in full game. Using Resource files and a simple array in GameState keeps this flexible.

- **Alternative considered:** Could use a scrollable list instead of cards, but cards with visual hierarchy better support the "scan and compare" behavior desired for meaningful contract selection.

---

## Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `scripts/resources/contract.gd` | Create | Contract data Resource class |
| `scenes/hub/ContractCard.tscn` | Create | Reusable contract card component |
| `scripts/hub/contract_card.gd` | Create | Contract card behavior |
| `scenes/hub/screens/ContractsScreen.tscn` | Modify | Replace placeholder with contract board |
| `scripts/hub/screens/contracts_screen.gd` | Modify | Add board logic, card management |
| `scripts/autoload/game_state.gd` | Modify | Add contract tracking (available, active, completed) |
| `resources/contracts/merchants_escort.tres` | Create | Tutorial contract data |
| `resources/contracts/clear_the_ruins.tres` | Create | Combat contract data |
| `resources/contracts/border_dispute.tres` | Create | Choice contract data |

---

## Design Alignment

### Design Pillars Supported

**Meaningful Choice:** The Contract Board is the primary decision point where players choose their path. By displaying contracts side-by-side with clear reward and difficulty information, players can make informed strategic choices. The limited selection (2-3 at a time) prevents choice paralysis while maintaining consequence.

**Build & Command:** Contract rewards directly feed into company growth - more gold means more soldiers and better equipment. The board makes this connection visible by prominently displaying rewards.

### Player Fantasy Reinforcement

The Contract Board reinforces the "mercenary company commander" fantasy by presenting missions as business opportunities. Players aren't given quests - they choose contracts, weighing risk vs reward like a professional mercenary captain would. The board-style presentation evokes a tavern notice board or military briefing room.

---

## Hardcoded Values Reference

| Value | Amount | Location |
|-------|--------|----------|
| Max contracts displayed | 3 | contracts_screen.gd |
| Contract card width | 300px | ContractCard.tscn |
| Contract card height | 150px | ContractCard.tscn |
| Card spacing | 20px | contracts_screen.gd |
| Merchant's Escort reward | 300g | merchants_escort.tres |
| Clear the Ruins reward | 500g | clear_the_ruins.tres |
| Border Dispute reward | 300-600g | border_dispute.tres |
| Easy difficulty | 1 star | contract.gd enum |
| Medium difficulty | 2 stars | contract.gd enum |
| Hard difficulty | 3 stars | contract.gd enum |
