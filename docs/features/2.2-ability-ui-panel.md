# Feature Spec: Ability UI Panel

| Property | Value |
|----------|-------|
| **Feature ID** | 2.2 |
| **Status** | ðŸ”´ Planned |
| **Priority** | ðŸ”¥ Critical |
| **Estimated Time** | 1.5 hours |
| **Phase** | Phase 2: Abilities & Party Interaction |
| **Dependencies** | Task 2.1 (Party Members with Abilities exist) |

---

## 1. Purpose

### Why This Feature Exists

Combat in Blood & Gold centers on tactical ability usage - each party member brings unique abilities that define their role. Without a visible ability panel, players cannot see what options are available, which abilities are on cooldown, or how to activate them. This feature provides the primary interface for ability selection, directly supporting the **Tactical Combat** design pillar by surfacing all combat options to the player.

### What It Enables

- Visual display of all 4 abilities for the selected unit
- Clear indication of which abilities are available vs unavailable
- Click-to-select ability interface leading to targeting mode
- Foundation for the complete ability workflow (select ability â†’ select target â†’ execute)
- Quick reference for ability names while learning the game
- Visual feedback for cooldowns and resource costs (future enhancement)

### Success Criteria

| Criterion | Measurement |
|-----------|-------------|
| Visibility | Ability bar appears when friendly unit selected |
| Ability count | Exactly 4 ability buttons displayed |
| Icons displayed | Each button shows an icon (placeholder or real) |
| Names displayed | Each button shows ability name |
| Unavailable state | Unavailable abilities are visually grayed out |
| Clickable | Can click an available ability button |
| Hides properly | Ability bar hides when no unit selected |

---

## 2. Design Pillar Alignment

| Pillar | How This Feature Supports It |
|--------|------------------------------|
| **Tactical Combat** | Abilities ARE tactical combat. Showing all 4 abilities lets players plan their actions - "Should I use Power Attack or Shield Bash?" The UI is the player's window into tactical options. |
| **Build & Command** | Each party member has unique abilities. The ability panel shows what makes Thorne different from Lyra. This reinforces the mercenary captain fantasy of commanding specialists. |
| **Meaningful Choice** | Every ability is a choice. The UI presents these choices clearly - available abilities are bright, unavailable are dimmed. No hidden options, no mystery about what you can do. |

---

## 3. How It Works

### Overview

The Ability UI Panel is a horizontal bar at the bottom center of the screen that displays 4 ability buttons when a friendly unit is selected. Each button shows an icon and the ability's name. The panel responds to unit selection - appearing when a friendly unit is selected and hiding when no unit is selected.

Abilities can be in two states: available (clickable, full color) or unavailable (non-clickable, grayed out). An ability is unavailable if it has already been used this turn, if there are no valid targets, or if any prerequisites aren't met.

Clicking an available ability button will transition the game to "targeting mode" (implemented in Task 2.4), where the player selects a target for the ability. For now (Task 2.2), clicking an ability will emit a signal for future connection.

### User Flow

```
ABILITY SELECTION FLOW:
1. Player selects a friendly unit (click or turn starts)
2. CombatManager emits unit_selected signal
3. AbilityBar receives signal, shows itself
4. AbilityBar queries unit for its 4 abilities
5. For each ability:
   - Display icon in button
   - Display name below icon
   - Check if ability is available
   - If unavailable, gray out button
6. Player sees 4 ability buttons at bottom of screen

CLICKING AN ABILITY:
1. Player clicks available ability button
2. Button emits ability_selected signal with ability data
3. (Future Task 2.4) Game enters targeting mode
4. Ability bar shows selected ability highlighted

DESELECTION FLOW:
1. Player clicks empty tile or enemy / turn ends
2. CombatManager emits unit_deselected signal
3. AbilityBar hides itself
```

### Rules & Constraints

| Rule | Description |
|------|-------------|
| 4 abilities always | Every unit shows exactly 4 ability buttons |
| Friendly units only | Ability bar only shows for friendly (party) units |
| Position-based check | Some abilities require adjacency or range (future) |
| Turn-based availability | Used abilities may be unavailable until next turn |
| Visual-only initially | Task 2.2 only shows UI; execution comes in later tasks |
| Bottom center fixed | Bar position doesn't move or resize |

### Edge Cases

| Scenario | Behavior |
|----------|----------|
| Unit has fewer than 4 abilities | Show empty/placeholder slots for missing abilities |
| All abilities unavailable | Show all 4 buttons grayed out, no interaction |
| Unit dies while selected | Hide ability bar (unit_deselected will fire) |
| Enemy unit clicked | Don't show ability bar (enemies have AI, not player abilities) |
| Rapid selection changes | Cancel any pending state, update to new unit's abilities |
| Click unavailable ability | No response (button disabled) |

---

## 4. User Interaction

### Controls

| Input | Action | Context |
|-------|--------|---------|
| Click ability button | Select ability for use | Ability is available |
| Click ability button | No effect (disabled) | Ability is unavailable |
| Hover ability button | Show hover state | Any ability button |
| (Future) Right-click | Show ability tooltip | Ability button |

### Visual Feedback

| Event | Visual |
|-------|--------|
| Ability bar appears | Fade in from transparent |
| Ability available | Full color icon, white text |
| Ability unavailable | Grayed out icon, gray text |
| Button hover | Slight brightness increase, subtle scale |
| Button pressed | Slight scale down |
| Ability selected | Border highlight or glow (future) |

### Audio Feedback (Future)

| Event | Sound |
|-------|-------|
| Ability bar appears | Subtle UI whoosh |
| Hover ability | Light tick |
| Click ability | Confirm sound |
| Click unavailable | Error/denied sound |

*Note: Audio is out of scope for prototype but noted for future.*

---

## 5. Visual Design

### AbilityBar Layout

```
Screen Bottom Center:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ABILITY BAR                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   ICON   â”‚  â”‚   ICON   â”‚  â”‚   ICON   â”‚  â”‚   ICON   â”‚        â”‚
â”‚  â”‚  48x48   â”‚  â”‚  48x48   â”‚  â”‚  48x48   â”‚  â”‚  48x48   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚   Ability 1     Ability 2     Ability 3     Ability 4           â”‚
â”‚   (Name)        (Name)        (Name)        (Name)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visual Components

| Component | Purpose | Style |
|-----------|---------|-------|
| Background Panel | Container for ability buttons | #1a1a2e, 90% opacity, rounded corners |
| Ability Button | Clickable ability slot | 48x48 icon area, subtle border |
| Ability Icon | Visual representation of ability | 48x48 placeholder sprite |
| Ability Name | Text label under icon | Small white text, centered |
| Disabled Overlay | Indicates unavailable | Semi-transparent gray overlay |

### Color Scheme

| Element | Available | Unavailable |
|---------|-----------|-------------|
| Icon | Full color | Desaturated/grayed |
| Name text | White (#ffffff) | Gray (#666666) |
| Button background | Transparent | Transparent + gray overlay |
| Button border | Subtle (#333333) | Same |
| Hover | Brightened | No hover effect |

### States

| State | Appearance |
|-------|------------|
| Hidden | Not visible (before unit selected) |
| Appearing | Fade in over 0.15 seconds |
| Visible | Fully opaque, buttons interactive |
| Available ability | Full color, hoverable, clickable |
| Unavailable ability | Grayed out, no hover, not clickable |
| Hovered | Slight glow/brightness on button |
| Pressed | Slight scale down on button |
| Selected (future) | Highlighted border/glow |

---

## 6. Technical Implementation

### Scene Structure

**scenes/UI/AbilityBar.tscn:**
```
AbilityBar (Control)
â”œâ”€â”€ PanelContainer (background)
â”‚   â””â”€â”€ MarginContainer
â”‚       â””â”€â”€ HBoxContainer (holds ability buttons)
â”‚           â”œâ”€â”€ AbilityButton1 (VBoxContainer)
â”‚           â”‚   â”œâ”€â”€ IconButton (TextureButton) - 48x48
â”‚           â”‚   â””â”€â”€ NameLabel (Label)
â”‚           â”œâ”€â”€ AbilityButton2 (VBoxContainer)
â”‚           â”‚   â”œâ”€â”€ IconButton (TextureButton) - 48x48
â”‚           â”‚   â””â”€â”€ NameLabel (Label)
â”‚           â”œâ”€â”€ AbilityButton3 (VBoxContainer)
â”‚           â”‚   â”œâ”€â”€ IconButton (TextureButton) - 48x48
â”‚           â”‚   â””â”€â”€ NameLabel (Label)
â”‚           â””â”€â”€ AbilityButton4 (VBoxContainer)
â”‚               â”œâ”€â”€ IconButton (TextureButton) - 48x48
â”‚               â””â”€â”€ NameLabel (Label)
```

### Script Responsibilities

**scripts/UI/ability_bar.gd (NEW):**
- Show/hide based on unit selection
- Populate ability buttons from unit's ability data
- Track available/unavailable state per ability
- Emit signals when ability clicked
- Handle visual states (hover, available, unavailable)
- Connect to CombatManager for selection changes

**scripts/combat/unit.gd (MODIFY):**
- Add `get_abilities() -> Array` method returning ability data
- Add `is_ability_available(ability_id: String) -> bool` method

**scripts/autoload/combat_manager.gd (ALREADY EXISTS):**
- Already emits `unit_selected` and `unit_deselected` signals
- No modifications needed for basic ability bar

### Detailed Script: ability_bar.gd

```gdscript
## AbilityBar - Displays 4 ability buttons for selected unit
## Part of: Blood & Gold Prototype
## Spec: docs/features/2.2-ability-ui-panel.md
class_name AbilityBar
extends Control

# ===== SIGNALS =====
signal ability_selected(ability_id: String, ability_data: Dictionary)

# ===== CONSTANTS =====
const FADE_DURATION: float = 0.15
const NUM_ABILITIES: int = 4
const ICON_SIZE: Vector2 = Vector2(48, 48)

# Unavailable state visuals
const COLOR_AVAILABLE: Color = Color.WHITE
const COLOR_UNAVAILABLE: Color = Color(0.4, 0.4, 0.4, 1.0)
const COLOR_NAME_AVAILABLE: Color = Color.WHITE
const COLOR_NAME_UNAVAILABLE: Color = Color(0.4, 0.4, 0.4, 1.0)

# ===== NODE REFERENCES =====
@onready var panel: PanelContainer = $PanelContainer
@onready var button_container: HBoxContainer = $PanelContainer/MarginContainer/HBoxContainer

# Array of ability button references [VBoxContainer, TextureButton, Label]
var _ability_buttons: Array[Dictionary] = []

# ===== INTERNAL STATE =====
var _current_unit: Unit = null
var _abilities: Array[Dictionary] = []

# ===== LIFECYCLE =====
func _ready() -> void:
	visible = false
	modulate.a = 0.0
	_setup_button_references()
	_connect_signals()
	_setup_panel_style()
	print("[AbilityBar] Initialized")

func _setup_button_references() -> void:
	## Cache references to ability button components
	for i in range(NUM_ABILITIES):
		var button_vbox = button_container.get_child(i) as VBoxContainer
		if button_vbox:
			var icon_button = button_vbox.get_node("IconButton") as TextureButton
			var name_label = button_vbox.get_node("NameLabel") as Label
			_ability_buttons.append({
				"container": button_vbox,
				"icon": icon_button,
				"label": name_label,
				"index": i
			})
			# Connect button press
			icon_button.pressed.connect(_on_ability_pressed.bind(i))

func _connect_signals() -> void:
	## Connect to CombatManager signals
	CombatManager.unit_selected.connect(_on_unit_selected)
	CombatManager.unit_deselected.connect(_on_unit_deselected)

func _setup_panel_style() -> void:
	## Configure panel background style
	var style = StyleBoxFlat.new()
	style.bg_color = Color("#1a1a2e")
	style.bg_color.a = 0.9  # 90% opacity
	style.corner_radius_top_left = 8
	style.corner_radius_top_right = 8
	style.corner_radius_bottom_left = 8
	style.corner_radius_bottom_right = 8
	style.content_margin_left = 16
	style.content_margin_right = 16
	style.content_margin_top = 12
	style.content_margin_bottom = 12
	panel.add_theme_stylebox_override("panel", style)

# ===== PUBLIC API =====
func show_for_unit(unit: Unit) -> void:
	## Show ability bar for the specified unit
	if not unit or unit.is_enemy:
		hide_bar()
		return

	_current_unit = unit
	_abilities = unit.get_abilities()
	_populate_buttons()
	_show_bar()
	print("[AbilityBar] Showing for %s with %d abilities" % [unit.unit_name, _abilities.size()])

func hide_bar() -> void:
	## Hide the ability bar
	if not visible:
		return

	var tween = create_tween()
	tween.tween_property(self, "modulate:a", 0.0, FADE_DURATION)
	tween.tween_callback(func():
		visible = false
		_current_unit = null
	)

func refresh() -> void:
	## Refresh availability states without repopulating
	if _current_unit:
		_update_availability_states()

# ===== INTERNAL METHODS =====
func _show_bar() -> void:
	## Animate bar appearing
	visible = true
	var tween = create_tween()
	tween.tween_property(self, "modulate:a", 1.0, FADE_DURATION)

func _populate_buttons() -> void:
	## Fill ability buttons with unit's ability data
	for i in range(NUM_ABILITIES):
		var button_data = _ability_buttons[i]
		var icon_button: TextureButton = button_data["icon"]
		var name_label: Label = button_data["label"]

		if i < _abilities.size():
			var ability = _abilities[i]
			# Set icon (placeholder or real)
			icon_button.texture_normal = _get_ability_icon(ability)
			icon_button.custom_minimum_size = ICON_SIZE
			name_label.text = ability.get("name", "???")

			# Set availability
			var is_available = _current_unit.is_ability_available(ability.get("id", ""))
			_set_button_availability(button_data, is_available)
		else:
			# Empty slot
			icon_button.texture_normal = null
			name_label.text = ""
			_set_button_availability(button_data, false)

func _get_ability_icon(ability: Dictionary) -> Texture2D:
	## Get icon texture for ability (placeholder for now)
	var icon_path = ability.get("icon", "")
	if icon_path and ResourceLoader.exists(icon_path):
		return load(icon_path)
	# Return placeholder icon
	return _create_placeholder_icon()

func _create_placeholder_icon() -> Texture2D:
	## Create a placeholder icon texture
	var image = Image.create(int(ICON_SIZE.x), int(ICON_SIZE.y), false, Image.FORMAT_RGBA8)
	image.fill(Color(0.3, 0.3, 0.4, 1.0))
	return ImageTexture.create_from_image(image)

func _set_button_availability(button_data: Dictionary, is_available: bool) -> void:
	## Set visual state for available/unavailable
	var icon_button: TextureButton = button_data["icon"]
	var name_label: Label = button_data["label"]

	icon_button.disabled = not is_available
	icon_button.modulate = COLOR_AVAILABLE if is_available else COLOR_UNAVAILABLE
	name_label.add_theme_color_override("font_color",
		COLOR_NAME_AVAILABLE if is_available else COLOR_NAME_UNAVAILABLE)

func _update_availability_states() -> void:
	## Update availability without full repopulate
	for i in range(NUM_ABILITIES):
		if i < _abilities.size():
			var ability = _abilities[i]
			var is_available = _current_unit.is_ability_available(ability.get("id", ""))
			_set_button_availability(_ability_buttons[i], is_available)

# ===== SIGNAL HANDLERS =====
func _on_unit_selected(unit: Unit) -> void:
	## Handle unit selection
	show_for_unit(unit)

func _on_unit_deselected(_unit: Unit) -> void:
	## Handle unit deselection
	hide_bar()

func _on_ability_pressed(index: int) -> void:
	## Handle ability button click
	if index >= _abilities.size():
		return

	var ability = _abilities[index]
	var ability_id = ability.get("id", "")

	# Check availability
	if not _current_unit or not _current_unit.is_ability_available(ability_id):
		return

	print("[AbilityBar] Ability selected: %s" % ability.get("name", ability_id))
	ability_selected.emit(ability_id, ability)
```

### Unit Ability Data (Add to unit.gd)

```gdscript
## Add to scripts/combat/unit.gd

# ===== ABILITY DATA =====
var _abilities: Array[Dictionary] = []

func _init_abilities() -> void:
	## Initialize abilities based on unit type
	match unit_type:
		UnitType.PLAYER:
			_abilities = [
				{"id": "basic_attack", "name": "Attack", "icon": ""},
				{"id": "power_attack", "name": "Power Attack", "icon": ""},
				{"id": "shield_bash", "name": "Shield Bash", "icon": ""},
				{"id": "rally", "name": "Rally", "icon": ""},
			]
		UnitType.THORNE:
			_abilities = [
				{"id": "basic_attack", "name": "Attack", "icon": ""},
				{"id": "cleave", "name": "Cleave", "icon": ""},
				{"id": "taunt", "name": "Taunt", "icon": ""},
				{"id": "last_stand", "name": "Last Stand", "icon": ""},
			]
		UnitType.LYRA:
			_abilities = [
				{"id": "basic_attack", "name": "Attack", "icon": ""},
				{"id": "backstab", "name": "Backstab", "icon": ""},
				{"id": "shadowstep", "name": "Shadowstep", "icon": ""},
				{"id": "poison_blade", "name": "Poison Blade", "icon": ""},
			]
		UnitType.MATTHIAS:
			_abilities = [
				{"id": "basic_attack", "name": "Attack", "icon": ""},
				{"id": "heal", "name": "Heal", "icon": ""},
				{"id": "bless", "name": "Bless", "icon": ""},
				{"id": "smite", "name": "Smite", "icon": ""},
			]
		_:
			# Default basic attack only for enemies/soldiers
			_abilities = [
				{"id": "basic_attack", "name": "Attack", "icon": ""},
			]

func get_abilities() -> Array[Dictionary]:
	## Get this unit's abilities
	return _abilities.duplicate()

func is_ability_available(ability_id: String) -> bool:
	## Check if an ability can be used
	## For now, all abilities are available (future: cooldowns, costs, targets)
	if ability_id.is_empty():
		return false
	# Check if ability exists for this unit
	for ability in _abilities:
		if ability.get("id") == ability_id:
			return true
	return false
```

### Integration Points

| System | Integration |
|--------|-------------|
| CombatManager | Emits unit_selected/unit_deselected signals |
| Unit | Provides get_abilities() and is_ability_available() |
| AbilityBar | Shows/hides based on selection, displays abilities |
| Future: Targeting (2.4) | Receives ability_selected signal to enter targeting mode |
| Future: Ability System (2.3+) | Actually executes selected abilities |

### Signals

| Signal | Emitter | Parameters | Purpose |
|--------|---------|------------|---------|
| `ability_selected` | AbilityBar | `(ability_id: String, ability_data: Dictionary)` | Player clicked an ability |

---

## 7. File Structure

```
scenes/
â””â”€â”€ UI/
    â””â”€â”€ AbilityBar.tscn            # NEW: Ability bar UI

scripts/
â””â”€â”€ UI/
    â””â”€â”€ ability_bar.gd             # NEW: Ability bar logic

scripts/combat/
â””â”€â”€ unit.gd                        # MODIFY: Add ability data methods

assets/sprites/ui/ability_icons/   # NEW DIRECTORY: Placeholder icons
â”œâ”€â”€ placeholder.png                # 48x48 placeholder icon
â””â”€â”€ (future ability icons)
```

---

## 8. Acceptance Criteria

| # | Criterion | Test Method |
|---|-----------|-------------|
| 1 | Ability bar shows when unit selected | Select a friendly unit, verify bar appears |
| 2 | 4 abilities displayed with icons | Count ability buttons, verify icons present |
| 3 | Ability names visible | Read ability name text under each icon |
| 4 | Can click ability button | Click available ability, check console log |
| 5 | Unavailable abilities grayed out | If any unavailable, verify gray appearance |
| 6 | Bar hides on deselect | Click empty tile, verify bar disappears |
| 7 | Different units show different abilities | Select Thorne, then Lyra, verify abilities change |
| 8 | Bar positioned bottom center | Visual inspection of position |

---

## 9. Testing Checklist

### Functional Tests
- [ ] Ability bar appears when selecting friendly unit
- [ ] Ability bar shows 4 buttons
- [ ] Each button has icon and name
- [ ] Clicking ability button emits signal
- [ ] Clicking disabled button does nothing
- [ ] Bar hides when unit deselected
- [ ] Bar hides when clicking empty tile
- [ ] Bar updates when selecting different unit

### Integration Tests
- [ ] CombatManager.unit_selected triggers bar show
- [ ] CombatManager.unit_deselected triggers bar hide
- [ ] Unit.get_abilities() returns correct abilities
- [ ] Player has correct 4 abilities (Attack, Power Attack, Shield Bash, Rally)
- [ ] Thorne has correct 4 abilities
- [ ] Lyra has correct 4 abilities
- [ ] Matthias has correct 4 abilities

### Visual Tests
- [ ] Background color correct (#1a1a2e at 90% opacity)
- [ ] Icon size correct (48x48)
- [ ] Bar positioned at bottom center
- [ ] Available abilities full color
- [ ] Unavailable abilities grayed out
- [ ] Hover effect on buttons
- [ ] Fade animation smooth

### Edge Cases
- [ ] Bar doesn't show for enemy units
- [ ] Bar handles rapid unit switching
- [ ] Bar handles unit dying while selected

---

## 10. Implementation Notes

### Approach Rationale

**Why fixed 4 ability slots?**
- Every party member has 4 abilities (from GDD)
- Consistent UI easier to read and use
- No need for scrolling or pagination
- Future: Could add more slots for items/special actions

**Why TextureButton vs Button?**
- TextureButton allows custom icon visuals
- Better control over disabled appearance
- Can add icon textures directly without themes

**Why Control (not CanvasLayer)?**
- Ability bar should be part of main UI layer
- Doesn't need to render above popups
- Simpler positioning with anchors

**Why bottom center position?**
- Traditional RPG ability bar location
- Near character position (bottom of screen)
- Doesn't obstruct the combat grid
- Easy to reach with mouse

### Gotchas to Watch

1. **Anchors and positioning**: Use anchors for bottom center placement, not hardcoded position
2. **Button references**: Cache references in _ready, don't search every frame
3. **Signal disconnection**: If unit freed, ensure signals don't cause errors
4. **Modulate vs visible**: Use modulate for fade, visible for hiding
5. **Ability data structure**: Keep flexible for future cooldowns, costs, tooltips

### Alternative Approaches Considered

| Approach | Pros | Cons | Decision |
|----------|------|------|----------|
| Popup on unit hover | Immediate access | Obstructs view | Rejected |
| Side panel | More info space | Screen real estate | Rejected |
| **Bottom bar** | Traditional, accessible | Limited space | **Chosen** |
| Radial menu | Touch-friendly | Harder to scan | Rejected |

### Dependencies on Previous Tasks

- **Task 2.1 (Party Members)**: Units must exist with ability data
- **Task 1.4 (Selection)**: CombatManager selection system must work
- **Task 1.8 (Turn System)**: Turn context for availability

### Future Enhancements (Out of Scope)

- Tooltips showing ability details on hover
- Cooldown indicators (turns remaining)
- Resource cost display (stamina, mana)
- Keyboard shortcuts (1, 2, 3, 4 keys)
- Selected ability highlight
- Ability preview (show effect range before confirm)
- Animation when abilities become available

---

## 11. Definition of Done

- [ ] `scenes/UI/AbilityBar.tscn` created with correct structure
- [ ] `scripts/UI/ability_bar.gd` implemented with all methods
- [ ] `scripts/combat/unit.gd` modified with ability data
- [ ] Ability bar shows on friendly unit selection
- [ ] Ability bar hides on deselection
- [ ] 4 ability buttons displayed with icons and names
- [ ] Available abilities clickable
- [ ] Unavailable abilities grayed out
- [ ] Click emits ability_selected signal
- [ ] Different party members show their unique abilities
- [ ] Bar positioned bottom center
- [ ] Background style correct (#1a1a2e, 90% opacity)
- [ ] Icon size correct (48x48)
- [ ] All acceptance criteria pass
- [ ] Console logging shows ability selection
- [ ] Code follows GDScript style guidelines

---

## 12. References

### From GDD

- **Party Abilities** (Section 3: Combat System):
  - Player: Power Attack (2x damage), Shield Bash (stun), Rally (buff)
  - Thorne: Cleave (multi-hit), Taunt (aggro), Last Stand (buff at low HP)
  - Lyra: Backstab (bonus from behind), Shadowstep (teleport), Poison Blade (DoT)
  - Matthias: Heal, Bless (buff), Smite (holy damage)
- **Combat Input**: "Click ability/attack, then target"
- **4 abilities per party member**: 12 unique abilities total

### From Roadmap

- **Task 2.2**: Ability UI Panel (Phase 2, 1.5 hours)
- **What**: When unit selected, show 4 ability buttons at bottom of screen
- **Dependencies**: Task 2.1 (party members exist)
- **Files**: scenes/UI/AbilityBar.tscn, scripts/UI/ability_bar.gd
- **Hardcoded Values**: Bottom center, 48x48 icons, #1a1a2e with 90% opacity
- **Related Tasks**: 2.3 (Single Target Abilities), 2.4 (Targeting Mode)

### Godot Documentation

- [Control](https://docs.godotengine.org/en/stable/classes/class_control.html)
- [TextureButton](https://docs.godotengine.org/en/stable/classes/class_texturebutton.html)
- [HBoxContainer](https://docs.godotengine.org/en/stable/classes/class_hboxcontainer.html)
- [StyleBoxFlat](https://docs.godotengine.org/en/stable/classes/class_styleboxflat.html)
